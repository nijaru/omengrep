[workspace]
name = "hygrep"
version = "0.1.0"
description = "Semantic code search with automatic indexing"
authors = ["nijaru"]
channels = ["conda-forge", "https://conda.modular.com/max/", "pytorch"]
platforms = ["osx-arm64", "linux-64"]

[dependencies]
max = "25.7.*"
python = ">=3.11,<3.14"
huggingface_hub = ">=1.1.6,<2"
numpy = ">=1.21,<3"
tokenizers = ">=0.22.1,<0.23"
pathspec = ">=0.12.1,<0.13"
onnxruntime = ">=1.16.0,<2"

[pypi-dependencies]
typer = ">=0.9.0"
rich = ">=13.0.0"
tree-sitter = ">=0.24.0"
tree-sitter-bash = ">=0.23.0"
tree-sitter-c = ">=0.23.0"
tree-sitter-c-sharp = ">=0.23.0"
tree-sitter-cpp = ">=0.23.0"
tree-sitter-elixir = ">=0.3.0"
tree-sitter-go = ">=0.23.0"
tree-sitter-java = ">=0.23.0"
tree-sitter-javascript = ">=0.23.0"
tree-sitter-json = ">=0.24.0"
tree-sitter-kotlin = ">=1.0.0"
tree-sitter-lua = ">=0.2.0"
tree-sitter-mojo = { git = "https://github.com/lsh/tree-sitter-mojo.git" }
tree-sitter-php = ">=0.23.0"
tree-sitter-python = ">=0.23.0"
tree-sitter-ruby = ">=0.23.0"
tree-sitter-rust = ">=0.23.0"
tree-sitter-svelte = ">=1.0.0"
tree-sitter-swift = ">=0.0.1"
tree-sitter-toml = ">=0.7.0"
tree-sitter-typescript = ">=0.23.0"
tree-sitter-yaml = ">=0.7.0"
tree-sitter-zig = ">=1.0.0"
# Optional: semantic search
omendb = ">=0.0.7"

[tasks]
# Build Mojo scanner as Python extension
build-ext = "mojo build src/scanner/_scanner.mojo --emit shared-lib -o src/hygrep/_scanner.so"
# Run CLI (semantic-first)
hhg = { cmd = "python -m hygrep.cli", env = { PYTHONPATH = "src" } }
# Run Mojo tests
test-mojo = "mojo -I . tests/test_regex_smoke.mojo && mojo -I . tests/test_scanner.mojo"
# Run Python tests
test-py = { cmd = "python tests/test_context.py && python tests/test_embedder.py && python tests/test_semantic.py && python tests/test_cli.py && python tests/test_golden.py && python tests/test_languages.py && python tests/test_scanner_fallback.py", env = { PYTHONPATH = "src" } }
# Run all tests
test = { depends-on = ["test-mojo", "test-py"] }
